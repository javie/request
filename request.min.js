(function(){var j,b,l,g,i,f;j=this;b=function(m){return b.make(m);};f={};if("undefined"!==typeof exports){throw new Error("Not supported");}if("undefined"===typeof j.Javie){throw new Error("Javie is required before using Javie.Request");
}j.Javie.Request=b;if("undefined"===typeof j.Javie.Events){throw new Error("Javie is missing Logger and Events");}i=j.Javie.Events.make();l=j._;if(!l&&"undefined"!==typeof require){l=require("underscore");
}g=j.$;if("undefined"===typeof g||null===g){throw new Error("Required jQuery or Zepto object is not available.");}function d(m){if(l.isString(m)){m=g.parseJSON(m);
}return m;}b.config={baseUrl:null,onError:function e(n,m){},beforeSend:function k(n,m){},onComplete:function c(n,m){}};b.put=function h(n,o){var m=(!l.isString(n))?n:{key:o};
this.config=l.defaults(m,this.config);};b.make=function a(n){var m,o,u,t,v;if(!l.isString(n)){n="default";}v=this;if(!l.isUndefined(f[n])){t=f[n];if(t.executed===true){u=l.uniqueId(n+"_");
o=v.make(u);i.clone("Request.onError: "+n).to("Request.onError: "+u);i.clone("Request.onComplete: "+n).to("Request.onComplete: "+u);i.clone("Request.beforeSend: "+n).to("Request.beforeSend: "+u);
o.put(t.config);return o;}return t;}m={executed:false,to:function s(z,y,x){var w,D,B,C,A;w=this;if(l.isUndefined(z)){throw new Error("Missing required parameter.");
}if(l.isNull(y)){y=j.document;}D=z.split(" ");B="GET";w.put({name:n,type:"GET",query:"",data:"",dataType:(!l.isUndefined(x)?x:"json"),id:"",object:y});
if(D.length===1){C=D[0];}else{if(l.indexOf(["POST","GET","PUT","DELETE"],D[0])>-1){B=D[0];}C=D[1];if(B!=="GET"){A=C.split("?");if(A.length>1){C=A[0];w.put("query",A[1]);
}}w.put({type:B,uri:C});}w.put("id","#"+g(w.get("object")).attr("id"));return this;},execute:function r(){var x,y;x=this;y=g(x.get("object")).serialize()+"&"+x.get("query");
if(y==="?&"){y="";}x.executed=true;i.fire("Request.beforeSend",[x]);i.fire("Request.beforeSend: "+n,[x]);x.config.beforeSend(x);g.ajax({type:x.get("type"),dataType:x.get("dataType"),url:x.get("uri"),data:y,complete:function w(B){var A,z;
if(B.responseText!==""){A=d(B.responseText);z=B.status;if(A.hasOwnProperty("errors")){i.fire("Request.onError",[A.errors,z,x]);i.fire("Request.onError: "+n,[A.errors,z,x]);
x.config.onError(A.errors,z,x);A.errors=null;}i.fire("Request.onComplete",[A,z,x]);i.fire("Request.onComplete: "+n,[A,z,x]);x.config.onComplete(A,z,x);
}}});},config:{name:"",type:"GET",uri:"",query:"",data:"",dataType:"json",id:"",object:null},put:function q(x,y){var w=(!l.isString(x)?x:{key:y});this.config=l.defaults(w,this.config);
},get:function p(w,x){if(l.isUndefined(x)){x=null;}return(!l.isUndefined(this.config[w])?this.config[w]:x);}};m.config=l.defaults(m.config,v.config);f[n]=m;
return f[n];};}).call(this);