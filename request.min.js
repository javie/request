(function(){var j,b,l,h,m,g;j=this;b=function(n){return b.make(n);};g={};if("undefined"!==typeof exports){throw new Error("Not supported");}if("undefined"===typeof j.Javie){throw new Error("Javie is missing");
}j.Javie.Request=b;if("undefined"===typeof j.Javie.EventDispatcher){throw new Error("Javie.EventDispatcher is missing");}m=j.Javie.EventDispatcher.make();
l=j._;if(!l&&"undefined"!==typeof require){l=require("underscore");}h=j.$;if("undefined"===typeof h||null===h){throw new Error("Required jQuery or Zepto object is not available.");
}function e(n){if(l.isString(n)){n=h.parseJSON(n);}return n;}b.config={baseUrl:null,onError:function f(o,n){},beforeSend:function k(o,n){},onComplete:function d(o,n){}};
b.put=function i(o,p){var n=o;if(!l.isObject(n)){n={};n[o.toString()]=p;}this.config=l.defaults(n,this.config);};b.get=function c(o,n){if(l.isUndefined(n)){n=null;
}if(l.isUndefined(this.config[o])){return n;}return this.config[o];};b.make=function a(o){var n,p,v,u,w;if(!l.isString(o)){o="default";}w=this;if(!l.isUndefined(g[o])){u=g[o];
if(u.executed===true){v=l.uniqueId(o+"_");p=w.make(v);m.clone("Request.onError: "+o).to("Request.onError: "+v);m.clone("Request.onComplete: "+o).to("Request.onComplete: "+v);
m.clone("Request.beforeSend: "+o).to("Request.beforeSend: "+v);p.put(u.config);return p;}return u;}n={executed:false,to:function t(A,z,y){var x,E,C,D,B;
x=this;if(l.isUndefined(A)){throw new Error("Missing required parameter.");}if(l.isNull(z)){z=j.document;}E=A.split(" ");C="GET";x.put({name:o,type:"GET",query:"",data:"",dataType:(!l.isUndefined(y)?y:"json"),id:"",object:z});
if(E.length===1){D=E[0];}else{if(l.indexOf(["POST","GET","PUT","DELETE"],E[0])>-1){C=E[0];}D=E[1];if(C!=="GET"){B=D.split("?");if(B.length>1){D=B[0];x.put("query",B[1]);
}}D=D.replace(":baseUrl",w.get("baseUrl",""));x.put({type:C,uri:D});}x.put("id","#"+h(x.get("object")).attr("id"));return this;},execute:function s(){var y,z;
y=this;z=h(y.get("object")).serialize()+"&"+y.get("query");if(z==="?&"){z="";}y.executed=true;m.fire("Request.beforeSend",[y]);m.fire("Request.beforeSend: "+o,[y]);
y.config.beforeSend(y);h.ajax({type:y.get("type"),dataType:y.get("dataType"),url:y.get("uri"),data:z,complete:function x(C){var B,A;if(C.responseText!==""){B=e(C.responseText);
A=C.status;if(!l.isUndefined(B)&&B.hasOwnProperty("errors")){m.fire("Request.onError",[B.errors,A,y]);m.fire("Request.onError: "+o,[B.errors,A,y]);y.config.onError(B.errors,A,y);
B.errors=null;}m.fire("Request.onComplete",[B,A,y]);m.fire("Request.onComplete: "+o,[B,A,y]);y.config.onComplete(B,A,y);}}});},config:{name:"",type:"GET",uri:"",query:"",data:"",dataType:"json",id:"",object:null},put:function r(y,z){var x=(!l.isString(y)?y:{key:z});
this.config=l.defaults(x,this.config);},get:function q(x,y){if(l.isUndefined(y)){y=null;}return(!l.isUndefined(this.config[x])?this.config[x]:y);}};n.config=l.defaults(n.config,w.config);
g[o]=n;return g[o];};}).call(this);