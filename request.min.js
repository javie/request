(function(){var j,b,l,g,i,f;j=this;b={};f={};if("undefined"!==typeof exports){throw new Error("Not supported");}if("undefined"===typeof j.Javie){throw new Error("Javie is required before using Javie.Request");
}j.Javie.Request=b;if("undefined"===typeof j.Javie.Events){throw new Error("Javie is missing Logger and Events");}i=j.Javie.Events.make();l=j._;if(!l&&"undefined"!==typeof require){l=require("underscore");
}g=j.$;if("undefined"===typeof g||null===g){throw new Error("Required jQuery or Zepto object is not available.");}function d(m){if(l.isString(m)){m=g.parseJSON(m);
}return m;}b.config={baseUrl:null,onError:function e(n,m){},beforeSend:function k(n,m){},onComplete:function c(n,m){}};b.put=function h(n,o){var m=(!l.isString(n))?n:{key:o};
this.config=l.defaults(m,this.config);};b.make=function a(n){var m,o,u,t,v;if(!l.isString(n)){n="default";}v=this;if(!l.isUndefined(f[n])){t=f[n];if(t.executed===true){u=l.uniqueId(n+"_");
o=v.make(u);i.clone("Request.onError: "+n).to("Request.onError: "+u);i.clone("Request.onComplete: "+n).to("Request.onComplete: "+u);i.clone("Request.beforeSend: "+n).to("Request.beforeSend: "+u);
o.put(t.config);return o;}return t;}m={executed:false,to:function s(A,z,x){var w,D,C,y,B;w=this;if(l.isUndefined(A)){throw new Error("Missing required parameter.");
}if(l.isNull(z)){z=j.document;}D=A.split(" ");C=["POST","GET","PUT","DELETE"];w.put({name:n,type:"GET",query:"",data:"",dataType:(!l.isUndefined(x)?x:"json"),id:"",object:z});
if(D.length===1){w.put("uri",D[0]);}else{if(l.indexOf(C,D[0])>-1){w.put("type",D[0]);}w.put("uri",D[1]);if(this.type!=="GET"){B=w.get("uri","").split("?");
if(B.length>0){w.put({query:B[1],uri:B[0]});}}}w.put("id","#"+g(w.get("object")).attr("id"));return this;},execute:function r(){var x,y;x=this;y=g(this.get("object")).serialize()+"&"+this.get("query");
this.executed=true;i.fire("Request.beforeSend",[x]);i.fire("Request.beforeSend: "+n,[x]);x.beforeSend(x);g.ajax({type:this.get("type"),dataType:this.get("dataType"),url:this.get("uri"),data:y,complete:function w(B){var A,z;
if(B.responseText!==""){A=d(B.responseText);z=B.status;if(A.hasOwnProperty("errors")){i.fire("Request.onError",[A.errors,z,x]);i.fire("Request.onError: "+n,[A.errors,z,x]);
x.onError(A.errors,z,x);A.errors=null;}i.emit("Request.onComplete",[A,z,x]);i.emit("Request.onComplete: "+n,[A,z,x]);x.onComplete(A,z,v);}}});},config:{name:"",type:"GET",uri:"",query:"",data:"",dataType:"json",id:"",object:null},put:function q(x,y){var w=(!l.isString(x)?x:{key:y});
this.config=l.defaults(w,this.config);},get:function p(w,x){if(l.isUndefined(x)){x=null;}return(!l.isUndefined(this.config[w])?this.config[w]:x);}};m.config=l.defaults(m.config,v.config);
f[n]=m;return f[n];};}).call(this);